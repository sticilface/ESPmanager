<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ESPmanager: readme</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ESPmanager
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">readme </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This is an attempt at a task schedular for ESP8266. Written in c++.</p>
<p>Most of the complexities are hidden under the hood, it seems to work very well.</p>
<h1>Key features:</h1>
<ul>
<li>NonBlocking. The loop is not blocked, as long as you do not call delay() in your functions.</li>
<li>Flexible. All tasks are std::function calls so can use std::bind or lambdas.</li>
<li>ASyncTasker - Creates a task instance that runs all tasks concurrently, usefull for driving displays whilst checking buttons etc. non premtive multitasking!<ul>
<li>This feature has a timeout feature so each loop cycle it will visit each task to see if it needs running. If one task takes more than the timeout then it exits, continuing where it left of next loop. This allows you to maintain say wifi or other tasks as well.</li>
</ul>
</li>
<li>SyncTasker - Creates a sequential Tasker that waits for previous event to finish before starting the next.<ul>
<li>This is good for running a sequence of events that depend on the previous finishing. This tasker can be set to repeat which will continue to loop around. See Blink example using this.</li>
</ul>
</li>
<li>addSubTasker&lt;class TaskerType&gt;(TaskerType tasker) - This function is very powerfull. It creates a new tasker, and adds the required loop functions to the parent tasker, and returns a pointer back to this new Tasker. Available to any Tasker instance. This allows you in any task to spawn a new tasker to run sync, or async along side existing tasks!! all non blocking!</li>
<li>Templated Tasks and loop methods, allow you to design your own <a class="el" href="class_task.html">Task</a> types and loop methods if required, the basic typedefs are created for you <code>ASyncTasker</code> and <code>SyncTasker</code>. Plans are to implement light weight methods and tasks that don't occupy much RAM. So you can develop using the verbose outputs, and switch to lightweight for production.</li>
</ul>
<h3>Examples</h3>
<p>Basic </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;Tasker.h&gt;</span></div><div class="line"></div><div class="line">ASyncTasker tasker; </div><div class="line"></div><div class="line"><span class="keywordtype">void</span> setup() {</div><div class="line">  Serial.begin(115200);</div><div class="line">  Serial.print(<span class="stringliteral">&quot;\nBOOTING....&quot;</span>);</div><div class="line">    <span class="comment">// prints hello after 10 seconds. </span></div><div class="line">    tasker.add( [] (<a class="code" href="class_task.html">Task</a> &amp; t) {</div><div class="line">        Serial.println(<span class="stringliteral">&quot;hello&quot;</span>); </div><div class="line">    }).setTimeout(10000); </div><div class="line">   <span class="comment">// prints hello again after 20 seconds </span></div><div class="line">    tasker.add( [] (<a class="code" href="class_task.html">Task</a> &amp; t) {</div><div class="line">        Serial.println(<span class="stringliteral">&quot;hello again&quot;</span>); </div><div class="line">    }).setTimeout(20000);  </div><div class="line">Serial.println(<span class="stringliteral">&quot;READY\n&quot;</span>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> loop() {</div><div class="line">tasker.loop();</div><div class="line">}</div></div><!-- fragment --><p>These two tasks run at the same time. This next example adds two tasks to a SyncTasker, which waits for the first task to run before running the next. Declare <code>SyncTasker tasker;</code> instead of <code>ASyncTasker tasker;</code> then each task will follow the next. </p><h3>Tasks</h3>
<p>Tasks are created internally with std::unique_ptr, they are deleted when they are complete. A reference is returned to the pointer at creation allowing you to set and change parameters, but do not convert to a pointer, as the lifetime of the object is not guarunteed! you have been warned! I may implement a method to check if a task is still running...</p>
<p>Each task callback is called with a reference to the task, so all task properties are changable within the callback. This allows you to test a condition and then change it at run time. eg </p><div class="fragment"><div class="line"><a class="code" href="class_task.html">Task</a> &amp; t = tasker.add( [] (<a class="code" href="class_task.html">Task</a> &amp; t) {</div><div class="line">     Serial.println(<span class="stringliteral">&quot;hello again&quot;</span>); </div><div class="line">     t.setRepeat(<span class="keyword">false</span>); <span class="comment">//  changes to no repeating, and deletes the task.</span></div><div class="line">     uint32_t count = t.count; <span class="comment">// returns the run number. </span></div><div class="line">     t.setTimeout(1000); <span class="comment">//  change the timout to 1 second from 20 seconds! </span></div><div class="line"> }).setTimeout(20000).setRepeat(<span class="keyword">true</span>); </div></div><!-- fragment --><p>Tasks can also be named <code>.setName(const char *)</code>, good for debugging as the name will appear in the debug output. ### Creating subtasks </p><div class="fragment"><div class="line">auto subtasker = tasker.addSubTasker&lt;SyncTasker&gt;();</div></div><!-- fragment --><p> This gives you a pointer to the sub tasker, behind the scenes it adds a loop() to the parent tasker, which is automatically deleted when the count of tasks == 0. This is unless you use <code>auto subtasker = tasker.addSubTasker&lt;SyncTasker&gt;(true)</code>, which prevents the subtasker from being deleted. Unless you've set this to true, it is probably safe to assume that the tasker has been deleted and you're accessing a null ptr!</p>
<h3>Debug out</h3>
<p>Using <code>tasker.debugOut(Serial);</code> gives you a list of all the current running tasks, and subtasks. </p><div class="fragment"><div class="line">*****  Tasker  *****  </div><div class="line">Heap: 43320</div><div class="line">Tasker: 0x3ffef290 - 4 Tasks Running</div><div class="line">    1. 0x3fff0a0c [N][Debug Out] priority 0, timeout = 10000, runcount = 1</div><div class="line">    2. Tasker: 0x3fff0a88 - 4 Tasks Running Parent Tasker 0x3ffef290</div><div class="line">       └ 1. 0x3fff0b14 [N][SubTask1.1] timeout = 30000, runcount = 0</div><div class="line">        └ 2. 0x3fff0b74 [N][SubTask1.2] timeout = 30000, runcount = 0</div><div class="line">         └ 3. 0x3fff0bd4 [N][SubTask1.3] timeout = 30000, runcount = 0</div><div class="line">          └ 4. 0x3fff0c3c [N][SubTask1.4] timeout = 30000, runcount = 0</div><div class="line">    3. Tasker: 0x3fff0cb8 - 1 Tasks Running Parent Tasker 0x3ffef290</div><div class="line">        └ 1. Tasker: 0x3fff0e88 - 1 Tasks Running Parent Tasker 0x3fff0cb8</div><div class="line">            1. Tasker: 0x3fff1328 - 20 Tasks Running Parent Tasker 0x3fff0e88</div><div class="line">               └ 1. 0x3fff13c4 [N][supernested] timeout = 10000, runcount = 0</div><div class="line">                └ 2. 0x3fff140c [N][supernested] timeout = 10000, runcount = 0</div><div class="line">                 └ 3. 0x3fff1474 [N][supernested] timeout = 10000, runcount = 0</div><div class="line">*****   END   *****</div></div><!-- fragment --><p> Tasks run async just appear as numbers, tasks run sync and depend on the previous finishing have └ and are indented. The memory location of all taskers and tasks is given to help debugging.</p>
<h3>Other</h3>
<ul>
<li>There are plans for a priority approach but it has not been implemented yet... watch this space.</li>
<li>I also plan to write lightweight less RAM hungry versions. </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
